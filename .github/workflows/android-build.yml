name: Build Android APK

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@4
      with:
        fetch-depth: 0  # Full history for proper versioning
    
    - name: Set up JDK 17
      uses: actions/setup-java@4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Setup Android SDK
      uses: android-actions/setup-android@3
      with:
        accept-android-sdk-licenses: true
    
    - name: Build APK
      id: build
      run: |
        cd apps/android
        chmod +x ./gradlew
        ./gradlew :app:assembleDebug
        echo "APK built successfully"
        
        # Find the APK file
        APK_PATH=$hfind . -name "*.apk" -type f | head -1)
        echo "API found at: $API_PATH"
        echo "apk_path=$APK_PATH" >> $GITHUB_OUTPUT
        
        # Get APK info
        echo "=== APK Information ==="
        ls -lh $APK_PATH
        echo "==================="
    
    - name: Upload APK artifact
      uses: actions/upload-artifact@4
      with:
        name: openclaw-android-apk
        path: apps/android/${ { steps.build.outputs.apk_path } }
        retention-days: 90
    
    - name: Show download instructions
      run: |
        echo "+â™… Build completed successfully!"
        echo ""
        echo "ðŸ–± To download the APK:"
        echo "1. Go to this workflow run"
        echo "2. Click on 'Artifacts' section"
        echo "3. Download 'openclaw-android-apk'"
        echo ""
        echo "ðŸ–² To install on Android:"
        echo "1. Enable 'Install from unknown sources' in settings"
        echo "2. Open the downloaded APK file"
        echo "3. Follow installation prompts"
        echo ""
        echo "ðŸ’“ To connect to your OpenClaw gateway:"
        echo "1. Ensure gateway is running on port 18789"
        echo "2. Open app â€“ Settings â€“ Discovered Gateways"
        echo "3. Select your gateway or use Manual Gateway"
        echo "4. Approve pairing: openclaw nodes approve <requestId>"